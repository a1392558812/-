"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7832],{ofWk:function(t,e,r){const i="undefined"==typeof window?r.g:window,s=i.performance?()=>i.performance.now():()=>Date.now(),o=i.requestAnimationFrame||(t=>setTimeout((()=>t(s())),1e3/60)),n=i.cancelAnimationFrame||clearTimeout;function a(t){return t[t.length-1]}const h=(t,e)=>t<0?e+t:t;let l=0;function c(t){return t.reduce(((t,e)=>e+t),0)/t.length}function u(t){var e=t.toUpperCase().trim();if(/^#([A-F0-9]{3}){1,2}$/.test(e)){let t=e.substring(1).split("");var r=""+(t=3===t.length?[t[0],t[0],t[1],t[1],t[2],t[2]]:t).join("");return{r:parseInt(r.slice(0,2),16),g:parseInt(r.slice(2,4),16),b:parseInt(r.slice(4,6),16),a:1}}if(r=e.match(/^RGBA?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d*\.?\d+))?\)$/))return{r:parseInt(r[1],10),g:parseInt(r[2],10),b:parseInt(r[3],10),a:parseFloat(r[4]||1,10)};throw new Error("Invalid color: "+t)}function d(t,e){var r={};for(let i=0;i<e;i++)r[i]=t;return r}const _=0<(r=(null==(r=i.navigator)?void 0:r.userAgent)||"").indexOf("MSIE ")||0<r.indexOf("Trident/")||0<r.indexOf("Edge/"),p=()=>{};class g{constructor(t,e,r=p){this._mutationChains=[],this._onStateChange=r,this.state={options:{drawingFadeDuration:e.drawingFadeDuration,drawingWidth:e.drawingWidth,drawingColor:u(e.drawingColor),strokeColor:u(e.strokeColor),outlineColor:u(e.outlineColor),radicalColor:u(e.radicalColor||e.strokeColor),highlightColor:u(e.highlightColor)},character:{main:{opacity:e.showCharacter?1:0,strokes:{}},outline:{opacity:e.showOutline?1:0,strokes:{}},highlight:{opacity:1,strokes:{}}},userStrokes:null};for(let e=0;e<t.strokes.length;e++)this.state.character.main.strokes[e]={opacity:1,displayPortion:1},this.state.character.outline.strokes[e]={opacity:1,displayPortion:1},this.state.character.highlight.strokes[e]={opacity:0,displayPortion:1}}overwriteOnStateChange(t){this._onStateChange=t}updateState(t){t=function t(e,r){var i={...e};for(const n in r){var s=e[n],o=r[n];s!==o&&(s&&o&&"object"==typeof s&&"object"==typeof o&&!Array.isArray(o)?i[n]=t(s,o):i[n]=o)}return i}(this.state,t),this._onStateChange(t,this.state),this.state=t}run(t,e={}){const r=t.map((t=>t.scope));return this.cancelMutations(r),new Promise((i=>{i={_isActive:!0,_index:0,_resolve:i,_mutations:t,_loop:e.loop,_scopes:r},this._mutationChains.push(i),this._run(i)}))}_run(t){if(t._isActive){var e=t._mutations;if(t._index>=e.length){if(!t._loop)return t._isActive=!1,this._mutationChains=this._mutationChains.filter((e=>e!==t)),void t._resolve({canceled:!1});t._index=0}t._mutations[t._index].run(this).then((()=>{t._isActive&&(t._index++,this._run(t))}))}}_getActiveMutations(){return this._mutationChains.map((t=>t._mutations[t._index]))}pauseAll(){this._getActiveMutations().forEach((t=>t.pause()))}resumeAll(){this._getActiveMutations().forEach((t=>t.resume()))}cancelMutations(t){for(const e of this._mutationChains)for(const r of e._scopes)for(const i of t)(r.startsWith(i)||i.startsWith(r))&&this._cancelMutationChain(e)}cancelAll(){this.cancelMutations([""])}_cancelMutationChain(t){var e;t._isActive=!1;for(let e=t._index;e<t._mutations.length;e++)t._mutations[e].cancel(this);null!=(e=t._resolve)&&e.call(t,{canceled:!0}),this._mutationChains=this._mutationChains.filter((e=>e!==t))}}const k=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),v=t=>Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),m=(t,e)=>v(k(t,e)),f=(t,e)=>t.x===e.x&&t.y===e.y,y=(t,e=1)=>(e*=10,{x:Math.round(e*t.x)/e,y:Math.round(e*t.y)/e}),C=t=>{let e=t[0];return t.slice(1).reduce(((t,r)=>{var i=m(r,e);return e=r,t+i}),0)},w=(t,e,r)=>(t=k(e,t),r/=v(t),{x:e.x+r*t.x,y:e.y+r*t.y}),S=t=>{t=((t,e=30)=>{var r=C(t)/(e-1),i=[t[0]],s=a(t),o=t.slice(1);for(let t=0;t<e-2;t++){let t=a(i),e=r,s=!1;for(;!s;){var n=m(t,o[0]);n<e?(e-=n,t=o.shift()):(n=w(t,o[0],e-n),i.push(n),s=!0)}}return i.push(s),i})(t);const e={x:c(t.map((t=>t.x))),y:c(t.map((t=>t.y)))};t=t.map((t=>k(t,e)));const r=Math.sqrt(c([Math.pow(t[0].x,2)+Math.pow(t[0].y,2),Math.pow(a(t).x,2)+Math.pow(a(t).y,2)]));var[t,i=.05]=[t.map((t=>({x:t.x/r,y:t.y/r})))],s=t.slice(0,1);for(const e of t.slice(1)){var o=s[s.length-1],n=m(e,o);if(i<n){var h=Math.ceil(n/i),l=n/h;for(let t=0;t<h;t++)s.push(w(e,o,-1*l*(t+1)))}else s.push(e)}return s};function P(t,e=!1){var r=y(t[0]);t=t.slice(1);let i=`M ${r.x} `+r.y;return t.forEach((t=>{t=y(t),i+=` L ${t.x} `+t.y})),e&&(i+="Z"),i}const D=(t,e)=>{var r,i;return t=(t=>{if(t.length<3)return t;const e=[t[0],t[1]];return t.slice(2).forEach((t=>{var r=e.length,i=k(t,e[r-1]);r=k(e[r-1],e[r-2]),i.y*r.x-i.x*r.y==0&&e.pop(),e.push(t)})),e})(t),t.length<2?t:(r=t[1],i=t[0],r=w(r,i,e),(i=t.slice(1)).unshift(r),i)};class x{constructor(t,e,r,i=!1){this.path=t,this.points=e,this.strokeNum=r,this.isInRadical=i}getStartingPoint(){return this.points[0]}getEndingPoint(){return this.points[this.points.length-1]}getLength(){return C(this.points)}getVectors(){let t=this.points[0];return this.points.slice(1).map((e=>{var r=k(e,t);return t=e,r}))}getDistance(t){var e=this.points.map((e=>m(e,t)));return Math.min(...e)}getAverageDistance(t){return t.reduce(((t,e)=>t+this.getDistance(e)),0)/t.length}}class M{constructor(t,e){this.symbol=t,this.strokes=e}}const[T,R]=[{x:0,y:-124},{x:1024,y:900}],A=R.x-T.x,b=R.y-T.y;class O{constructor(t){var{padding:t,width:e,height:r}=t,e=(this.padding=t,(this.width=e)-2*t),r=(this.height=r)-2*t,i=e/A,s=r/b;this.scale=Math.min(i,s),i=t+(e-this.scale*A)/2,s=t+(r-this.scale*b)/2,this.xOffset=-1*T.x*this.scale+i,this.yOffset=-1*T.y*this.scale+s}convertExternalPoint(t){return{x:(t.x-this.xOffset)/this.scale,y:(this.height-this.yOffset-t.y)/this.scale}}}const L=(t,e)=>{t=(t=>{const e=[];let r=t[0];return t.slice(1).forEach((t=>{e.push(k(t,r)),r=t})),e})(t);const r=e.getVectors();return 0<c(t.map((t=>{var e=r.map((e=>{return r=t,(e.x*r.x+e.y*r.y)/v(e)/v(r);var r}));return Math.max(...e)})))},E=[Math.PI/16,Math.PI/32,0,-1*Math.PI/32,-1*Math.PI/16],z=(t,e,r)=>{var{leniency:i=1,isOutlineVisible:s=!1,checkBackwards:o=!0,averageDistanceThreshold:n=350}=r,a=e.getAverageDistance(t);if(!(n=a<=n*(s||0<e.strokeNum?.5:1)*i))return{isMatch:!1,avgDist:a,meta:{isStrokeBackwards:!1}};var s=((t,e,r)=>{var i=m(e.getStartingPoint(),t[0]);return e=m(e.getEndingPoint(),t[t.length-1]),i<=250*r&&e<=250*r})(t,e,i),h=L(t,e),l=((t,e,r)=>{const i=S(t),s=S(e);let o=1/0;return E.forEach((t=>{var e;t=((t,e)=>{const r=t.length>=e.length?t:e,i=t.length>=e.length?e:t;var s,o,n,a;let h=[];for(let t=0;t<r.length;t++){var l=[];for(let e=0;e<i.length;e++)l.push((o=e,n=h,a=l,0===(s=t)&&0===o?m(r[0],i[0]):0<s&&0===o?Math.max(n[0],m(r[s],i[0])):(a=a[a.length-1],0===s&&0<o?Math.max(a,m(r[0],i[o])):Math.max(Math.min(n[o],n[o-1],a),m(r[s],i[o])))));h=l}return h[i.length-1]})(i,(e=t,s.map((t=>({x:Math.cos(e)*t.x-Math.sin(e)*t.y,y:Math.sin(e)*t.x+Math.cos(e)*t.y}))))),t<o&&(o=t)})),o<=.4*r})(t,e.points,i),i=((t,e,r)=>.35<=r*(C(t)+25)/(e.getLength()+25))(t,e,i),n=n&&s&&h&&l&&i;return o&&!n&&z([...t].reverse(),e,{...r,checkBackwards:!1}).isMatch?{isMatch:n,avgDist:a,meta:{isStrokeBackwards:!0}}:{isMatch:n,avgDist:a,meta:{isStrokeBackwards:!1}}};class W{constructor(t,e,r){this.id=t,this.points=[e],this.externalPoints=[r]}appendPoint(t,e){this.points.push(t),this.externalPoints.push(e)}}class ${constructor(t,e,r={}){this._tick=t=>{null===this._startPauseTime&&(1===(t=Math.min(1,(t-this._startTime-this._pausedDuration)/this._duration))?(this._renderState.updateState(this._values),this._frameHandle=void 0,this.cancel(this._renderState)):(t=H(t),t=function t(e,r,i){const s={};for(const o in r){const n=r[o],a=null==e?void 0:e[o];s[o]="number"==typeof a&&"number"==typeof n&&0<=n?i*(n-a)+a:t(a,n,i)}return s}(this._startState,this._values,t),this._renderState.updateState(t),this._frameHandle=o(this._tick)))},this.scope=t,this._valuesOrCallable=e,this._duration=r.duration||0,this._force=r.force,this._pausedDuration=0,this._startPauseTime=null}run(t){return this._values||this._inflateValues(t),0===this._duration&&t.updateState(this._values),0===this._duration||function t(e,r){for(const i in r){const s=r[i],o=null==e?void 0:e[i];if(0<=s){if(s!==o)return!1}else if(!t(o,s))return!1}return!0}(t.state,this._values)?Promise.resolve():(this._renderState=t,this._startState=t.state,this._startTime=performance.now(),this._frameHandle=o(this._tick),new Promise((t=>{this._resolve=t})))}_inflateValues(t){let e=this._valuesOrCallable;"function"==typeof this._valuesOrCallable&&(e=this._valuesOrCallable(t.state)),this._values=function(t,e){var r=t.split(".");let i=t={};for(let t=0;t<r.length;t++){var s=t===r.length-1?e:{};i[r[t]]=s,i=s}return t}(this.scope,e)}pause(){null===this._startPauseTime&&(this._frameHandle&&n(this._frameHandle),this._startPauseTime=performance.now())}resume(){null!==this._startPauseTime&&(this._frameHandle=o(this._tick),this._pausedDuration+=performance.now()-this._startPauseTime,this._startPauseTime=null)}cancel(t){var e;null!=(e=this._resolve)&&e.call(this),this._resolve=void 0,n(this._frameHandle||-1),this._frameHandle=void 0,this._force&&(this._values||this._inflateValues(t),t.updateState(this._values))}}$.Delay=class{constructor(t){this._duration=t,this._startTime=null,this._paused=!1,this.scope="delay."+t}run(){return this._startTime=s(),this._runningPromise=new Promise((t=>{this._resolve=t,this._timeout=setTimeout((()=>this.cancel()),this._duration)})),this._runningPromise}pause(){var t;this._paused||(t=performance.now()-(this._startTime||0),this._duration=Math.max(0,this._duration-t),clearTimeout(this._timeout),this._paused=!0)}resume(){this._paused&&(this._startTime=performance.now(),this._timeout=setTimeout((()=>this.cancel()),this._duration),this._paused=!1)}cancel(){clearTimeout(this._timeout),this._resolve&&this._resolve(),this._resolve=void 0}};const H=t=>-Math.cos(t*Math.PI)/2+.5,F=(t,e,r)=>[new $(`character.${t}.strokes`,d({opacity:1,displayPortion:1},e.strokes.length),{duration:r,force:!0})],I=(t,e,r)=>[new $("character."+t,{opacity:1,strokes:d({opacity:1,displayPortion:1},e.strokes.length)},{duration:r,force:!0})],B=(t,e,r)=>[new $(`character.${t}.opacity`,0,{duration:r,force:!0}),...F(t,e,0)],q=(t,e,r)=>[new $("options."+t,e,{duration:r})],U=(t,e,r)=>{var i=t.strokeNum;return t=(t.getLength()+600)/(3*r),[new $("options.highlightColor",e),new $("character.highlight",{opacity:1,strokes:{[i]:{displayPortion:0,opacity:0}}}),new $("character.highlight.strokes."+i,{displayPortion:1,opacity:1},{duration:t}),new $(`character.highlight.strokes.${i}.opacity`,0,{duration:t,force:!0})]},N=(t,e,r)=>{var i=e.strokeNum;return e=(e.getLength()+600)/(3*r),[new $("character."+t,{opacity:1,strokes:{[i]:{displayPortion:0,opacity:1}}}),new $(`character.${t}.strokes.${i}.displayPortion`,1,{duration:e})]},V=(t,e,r,i,s)=>{let o=B(t,e,r);return(o=o.concat(F(t,e,0))).push(new $("character."+t,{opacity:1,strokes:d({opacity:0},e.strokes.length)},{force:!0})),e.strokes.forEach(((e,r)=>{0<r&&o.push(new $.Delay(s)),o=o.concat(N(t,e,i))})),o},j=(t,e)=>[new $(`userStrokes.${t}.opacity`,0,{duration:e}),new $("userStrokes."+t,null,{force:!0})];class Q{constructor(t,e,r){this._currentStrokeIndex=0,this._mistakesOnStroke=0,this._totalMistakes=0,this._character=t,this._renderState=e,this._isActive=!1,this._positioner=r}startQuiz(t){this._isActive=!0,this._options=t;var e=h(t.quizStartStrokeNum,this._character.strokes.length);return this._currentStrokeIndex=Math.min(e,this._character.strokes.length-1),this._mistakesOnStroke=0,this._totalMistakes=0,this._renderState.run(((t,e,r)=>[...B("main",t,e),new $("character.highlight",{opacity:1,strokes:d({opacity:0},t.strokes.length)},{force:!0}),new $("character.main",{opacity:1,strokes:function(t,e){var r={};for(let i=0;i<t;i++)r[i]=e(i);return r}(t.strokes.length,(t=>({opacity:t<r?1:0})))},{force:!0})])(this._character,t.strokeFadeDuration,this._currentStrokeIndex))}startUserStroke(t){var e,r;return this._isActive?this._userStroke?this.endUserStroke():(e=this._positioner.convertExternalPoint(t),r=++l,this._userStroke=new W(r,e,t),this._renderState.run((t=r,r=e,[new $("quiz.activeUserStrokeId",t,{force:!0}),new $("userStrokes."+t,{points:[r],opacity:1},{force:!0})]))):null}continueUserStroke(t){var e;return this._userStroke?(e=this._positioner.convertExternalPoint(t),this._userStroke.appendPoint(e,t),e=this._userStroke.points.slice(0),this._renderState.run((t=this._userStroke.id,[new $(`userStrokes.${t}.points`,e,{force:!0})]))):Promise.resolve()}setPositioner(t){this._positioner=t}endUserStroke(){var t,e,r,i,s;this._userStroke&&(this._renderState.run(j(this._userStroke.id,null!=(s=this._options.drawingFadeDuration)?s:300)),1!==this._userStroke.points.length&&(({acceptBackwardsStrokes:s,markStrokeCorrectAfterMisses:i}=this._options),t=this._getCurrentStroke(),({isMatch:r,meta:e}=function(t,e,r,i={}){e=e.strokes;var s=(t=>{if(t.length<2)return t;const[e,...r]=t,i=[e];for(const t of r)f(t,i[i.length-1])||i.push(t);return i})(t.points);if(s.length<2)return{isMatch:!1,meta:{isStrokeBackwards:!1}};const{isMatch:o,meta:n,avgDist:a}=z(s,e[r],i);if(o){var h=e.slice(r+1);let o=a;for(let t=0;t<h.length;t++){const{isMatch:e,avgDist:r}=z(s,h[t],{...i,checkBackwards:!1});e&&r<o&&(o=r)}if(o<a){t=.6*(o+a)/(2*a);const{isMatch:n,meta:h}=z(s,e[r],{...i,leniency:(i.leniency||1)*t});return{isMatch:n,meta:h}}}return{isMatch:o,meta:n}}(this._userStroke,this._character,this._currentStrokeIndex,{isOutlineVisible:0<this._renderState.state.character.outline.opacity,leniency:this._options.leniency,averageDistanceThreshold:this._options.averageDistanceThreshold})),i=i&&this._mistakesOnStroke+1>=i,r||i||e.isStrokeBackwards&&s?this._handleSuccess(e):(this._handleFailure(e),({showHintAfterMisses:r,highlightColor:i,strokeHighlightSpeed:s}=this._options),!1!==r&&this._mistakesOnStroke>=r&&this._renderState.run(U(t,u(i),s)))),this._userStroke=void 0)}cancel(){this._isActive=!1,this._userStroke&&this._renderState.run(j(this._userStroke.id,this._options.drawingFadeDuration))}_getStrokeData({isCorrect:t,meta:e}){return{character:this._character.symbol,strokeNum:this._currentStrokeIndex,mistakesOnStroke:this._mistakesOnStroke,totalMistakes:this._totalMistakes,strokesRemaining:this._character.strokes.length-this._currentStrokeIndex-(t?1:0),drawnPath:{pathString:P((t=this._userStroke).externalPoints),points:t.points.map((t=>y(t)))},isBackwards:e.isStrokeBackwards}}_handleSuccess(t){if(this._options){var{strokes:e,symbol:r}=this._character,{onCorrectStroke:i,onComplete:s,highlightOnComplete:o,strokeFadeDuration:n,highlightCompleteColor:a,highlightColor:h,strokeHighlightDuration:l}=this._options;null!=i&&i({...this._getStrokeData({isCorrect:!0,meta:t})}),i="main",t=this._currentStrokeIndex;let c=[new $(`character.${i}.strokes.`+t,{displayPortion:1,opacity:1},{duration:n,force:!0})];this._mistakesOnStroke=0,this._currentStrokeIndex+=1,this._currentStrokeIndex===e.length&&(this._isActive=!1,null!=s&&s({character:r,totalMistakes:this._totalMistakes}),o)&&(c=c.concat((i=this._character,t=u(a||h),n=2*(l||0),[new $("options.highlightColor",t),...B("highlight",i),...I("highlight",i,n/2),...B("highlight",i,n/2)]))),this._renderState.run(c)}}_handleFailure(t){var e,r;this._mistakesOnStroke+=1,this._totalMistakes+=1,null!=(e=(r=this._options).onMistake)&&e.call(r,this._getStrokeData({isCorrect:!1,meta:t}))}_getCurrentStroke(){return this._character.strokes[this._currentStrokeIndex]}}function G(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function K(t,e,r){t.setAttributeNS(null,e,r)}function X(t,e){Object.keys(e).forEach((r=>K(t,r,e[r])))}function Y(t){var e;null!=t&&null!=(e=t.parentNode)&&e.removeChild(t)}class J{constructor(t){this.stroke=t,this._pathLength=t.getLength()+J.STROKE_WIDTH/2}_getStrokeDashoffset(t){return.999*this._pathLength*(1-t)}_getColor({strokeColor:t,radicalColor:e}){return e&&this.stroke.isInRadical?e:t}}J.STROKE_WIDTH=200;class Z extends J{constructor(t){super(t),this._oldProps=void 0}mount(t){this._animationPath=G("path"),this._clip=G("clipPath"),this._strokePath=G("path");var e="mask-"+ ++l;return K(this._clip,"id",e),K(this._strokePath,"d",this.stroke.path),this._animationPath.style.opacity="0",K(this._animationPath,"clip-path",function(t){let e="";return`url("${e=window.location&&window.location.href?window.location.href.replace(/#[^#]*$/,"").replace(/"/gi,"%22"):e}#${t}")`}(e)),e=D(this.stroke.points,100),K(this._animationPath,"d",P(e)),X(this._animationPath,{stroke:"#FFFFFF","stroke-width":200..toString(),fill:"none","stroke-linecap":"round","stroke-linejoin":"miter","stroke-dasharray":this._pathLength+","+this._pathLength}),this._clip.appendChild(this._strokePath),t.defs.appendChild(this._clip),t.svg.appendChild(this._animationPath),this}render(t){var e,r,i,s;t!==this._oldProps&&this._animationPath&&(t.displayPortion!==(null==(e=this._oldProps)?void 0:e.displayPortion)&&(this._animationPath.style.strokeDashoffset=this._getStrokeDashoffset(t.displayPortion).toString()),e=this._getColor(t),this._oldProps&&e===this._getColor(this._oldProps)||(({r:e,g:r,b:i,a:s}=e),X(this._animationPath,{stroke:`rgba(${e},${r},${i},${s})`})),t.opacity!==(null==(e=this._oldProps)?void 0:e.opacity)&&(this._animationPath.style.opacity=t.opacity.toString()),this._oldProps=t)}}class tt{constructor(t){this._oldProps=void 0,this._strokeRenderers=t.strokes.map((t=>new Z(t)))}mount(t){const e=t.createSubRenderTarget();this._group=e.svg,this._strokeRenderers.forEach((t=>{t.mount(e)}))}render(t){if(t!==this._oldProps&&this._group){var e,r,{opacity:i,strokes:s,strokeColor:o,radicalColor:n=null}=t,a=(i!==(null==(e=this._oldProps)?void 0:e.opacity)&&(this._group.style.opacity=i.toString(),_||(0===i?this._group.style.display="none":0===(null==(e=this._oldProps)?void 0:e.opacity)&&this._group.style.removeProperty("display"))),!this._oldProps||o!==this._oldProps.strokeColor||n!==this._oldProps.radicalColor);if(a||s!==(null==(i=this._oldProps)?void 0:i.strokes))for(let t=0;t<this._strokeRenderers.length;t++)!a&&null!=(r=this._oldProps)&&r.strokes&&s[t]===this._oldProps.strokes[t]||this._strokeRenderers[t].render({strokeColor:o,radicalColor:n,opacity:s[t].opacity,displayPortion:s[t].displayPortion});this._oldProps=t}}}class et{constructor(){this._oldProps=void 0}mount(t){this._path=G("path"),t.svg.appendChild(this._path)}render(t){var e,r,i,s;this._path&&t!==this._oldProps&&(t.strokeColor===(null==(e=this._oldProps)?void 0:e.strokeColor)&&t.strokeWidth===(null==(e=this._oldProps)?void 0:e.strokeWidth)||(({r:e,g:r,b:i,a:s}=t.strokeColor),X(this._path,{fill:"none",stroke:`rgba(${e},${r},${i},${s})`,"stroke-width":t.strokeWidth.toString(),"stroke-linecap":"round","stroke-linejoin":"round"})),t.opacity!==(null==(e=this._oldProps)?void 0:e.opacity)&&K(this._path,"opacity",t.opacity.toString()),t.points!==(null==(r=this._oldProps)?void 0:r.points)&&K(this._path,"d",P(t.points)),this._oldProps=t)}destroy(){Y(this._path)}}class rt{constructor(t){this.node=t}addPointerStartListener(t){this.node.addEventListener("mousedown",(e=>{t(this._eventify(e,this._getMousePoint))})),this.node.addEventListener("touchstart",(e=>{t(this._eventify(e,this._getTouchPoint))}))}addPointerMoveListener(t){this.node.addEventListener("mousemove",(e=>{t(this._eventify(e,this._getMousePoint))})),this.node.addEventListener("touchmove",(e=>{t(this._eventify(e,this._getTouchPoint))}))}addPointerEndListener(t){document.addEventListener("mouseup",t),document.addEventListener("touchend",t)}getBoundingClientRect(){return this.node.getBoundingClientRect()}updateDimensions(t,e){this.node.setAttribute("width",""+t),this.node.setAttribute("height",""+e)}_eventify(t,e){return{getPoint:()=>e.call(this,t),preventDefault:()=>t.preventDefault()}}_getMousePoint(t){var{left:e,top:r}=this.getBoundingClientRect();return{x:t.clientX-e,y:t.clientY-r}}_getTouchPoint(t){var{left:e,top:r}=this.getBoundingClientRect();return{x:t.touches[0].clientX-e,y:t.touches[0].clientY-r}}}class it extends rt{constructor(t,e){super(t),this.svg=t,this.defs=e,"createSVGPoint"in t&&(this._pt=t.createSVGPoint())}static init(t,e="100%",r="100%"){const i="string"==typeof t?document.getElementById(t):t;if(!i)throw new Error("HanziWriter target element not found: "+t);const s=i.nodeName.toUpperCase();return X(t="SVG"===s||"G"===s?i:(t=G("svg"),i.appendChild(t),t),{width:e,height:r}),e=G("defs"),t.appendChild(e),new it(t,e)}createSubRenderTarget(){var t=G("g");return this.svg.appendChild(t),new it(t,this.defs)}_getMousePoint(t){var e;return this._pt&&(this._pt.x=t.clientX,this._pt.y=t.clientY,"getScreenCTM"in this.node)?{x:(e=this._pt.matrixTransform(null==(e=this.node.getScreenCTM())?void 0:e.inverse())).x,y:e.y}:super._getMousePoint.call(this,t)}_getTouchPoint(t){var e;return this._pt&&(this._pt.x=t.touches[0].clientX,this._pt.y=t.touches[0].clientY,"getScreenCTM"in this.node)?{x:(e=this._pt.matrixTransform(null==(e=this.node.getScreenCTM())?void 0:e.inverse())).x,y:e.y}:super._getTouchPoint(t)}}var st={HanziWriterRenderer:class{constructor(t,e){this._character=t,this._positioner=e,this._mainCharRenderer=new tt(t),this._outlineCharRenderer=new tt(t),this._highlightCharRenderer=new tt(t),this._userStrokeRenderers={}}mount(t){var e=(t=t.createSubRenderTarget()).svg,{xOffset:r,yOffset:i,height:s,scale:o}=this._positioner;K(e,"transform",`translate(${r}, ${s-i}) scale(${o}, ${-1*o})`),this._outlineCharRenderer.mount(t),this._mainCharRenderer.mount(t),this._highlightCharRenderer.mount(t),this._positionedTarget=t}render(t){var e,r,{main:i,outline:s,highlight:o}=t.character,{outlineColor:n,radicalColor:a,highlightColor:h,strokeColor:l,drawingWidth:c,drawingColor:u}=t.options,d=(this._outlineCharRenderer.render({opacity:s.opacity,strokes:s.strokes,strokeColor:n}),this._mainCharRenderer.render({opacity:i.opacity,strokes:i.strokes,strokeColor:l,radicalColor:a}),this._highlightCharRenderer.render({opacity:o.opacity,strokes:o.strokes,strokeColor:h}),t.userStrokes||{});for(const t in this._userStrokeRenderers)d[t]||(null!=(e=this._userStrokeRenderers[t])&&e.destroy(),delete this._userStrokeRenderers[t]);for(const t in d){var _=d[t];_&&(_={strokeWidth:c,strokeColor:u,..._},r=void 0,(this._userStrokeRenderers[t]||((r=new et).mount(this._positionedTarget),this._userStrokeRenderers[t]=r)).render(_))}}destroy(){Y(this._positionedTarget.svg),this._positionedTarget.defs.innerHTML=""}},createRenderTarget:it.init};const ot=(t,e)=>{t.beginPath();var r=e[0];e=e.slice(1),t.moveTo(r.x,r.y);for(const r of e)t.lineTo(r.x,r.y);t.stroke()};class nt extends J{constructor(t,e=!0){super(t),e&&Path2D?this._path2D=new Path2D(this.stroke.path):this._pathCmd=(t=>{t=t.split(/(^|\s+)(?=[A-Z])/).filter((t=>" "!==t));const e=[t=>t.beginPath()];for(const s of t){var[r,...i]=s.split(/\s+/);const t=i.map((t=>parseFloat(t)));"M"===r?e.push((e=>e.moveTo(...t))):"L"===r?e.push((e=>e.lineTo(...t))):"C"===r?e.push((e=>e.bezierCurveTo(...t))):"Q"===r&&e.push((e=>e.quadraticCurveTo(...t)))}return t=>e.forEach((e=>e(t)))})(this.stroke.path),this._extendedMaskPoints=D(this.stroke.points,J.STROKE_WIDTH/2)}render(t,e){var r,i,s,o;e.opacity<.05||(({r:s,g:o,b:r,a:i}=(t.save(),this._path2D?t.clip(this._path2D):(null!=(s=this._pathCmd)&&s.call(this,t),t.globalAlpha=0,t.stroke(),t.clip()),this._getColor(e))),s=1===i?`rgb(${s},${o},${r})`:`rgb(${s},${o},${r},${i})`,o=this._getStrokeDashoffset(e.displayPortion),t.globalAlpha=e.opacity,t.strokeStyle=s,t.fillStyle=s,t.lineWidth=J.STROKE_WIDTH,t.lineCap="round",t.lineJoin="round",t.setLineDash([this._pathLength,this._pathLength],o),t.lineDashOffset=o,ot(t,this._extendedMaskPoints),t.restore())}}class at{constructor(t){this._strokeRenderers=t.strokes.map((t=>new nt(t)))}render(t,e){if(!(e.opacity<.05)){var{opacity:r,strokeColor:i,radicalColor:s,strokes:o}=e;for(let e=0;e<this._strokeRenderers.length;e++)this._strokeRenderers[e].render(t,{strokeColor:i,radicalColor:s,opacity:o[e].opacity*r,displayPortion:o[e].displayPortion||0})}}}class ht extends rt{constructor(t){super(t)}static init(t,e="100%",r="100%"){const i="string"==typeof t?document.getElementById(t):t;if(!i)throw new Error("HanziWriter target element not found: "+t);return(t="CANVAS"===i.nodeName.toUpperCase()?i:(t=document.createElement("canvas"),i.appendChild(t),t)).setAttribute("width",e),t.setAttribute("height",r),new ht(t)}getContext(){return this.node.getContext("2d")}}var lt={HanziWriterRenderer:class{constructor(t,e){this.destroy=p,this._character=t,this._positioner=e,this._mainCharRenderer=new at(t),this._outlineCharRenderer=new at(t),this._highlightCharRenderer=new at(t)}mount(t){this._target=t}_animationFrame(t){var{width:e,height:r,scale:i,xOffset:s,yOffset:o}=this._positioner,n=this._target.getContext();n.clearRect(0,0,e,r),n.save(),n.translate(s,r-o),n.transform(1,0,0,-1,0,0),n.scale(i,i),t(n),n.restore(),n.draw&&n.draw()}render(t){const{outline:e,main:r,highlight:i}=t.character,{outlineColor:s,strokeColor:o,radicalColor:n,highlightColor:a,drawingColor:h,drawingWidth:l}=t.options;this._animationFrame((c=>{this._outlineCharRenderer.render(c,{opacity:e.opacity,strokes:e.strokes,strokeColor:s}),this._mainCharRenderer.render(c,{opacity:r.opacity,strokes:r.strokes,strokeColor:o,radicalColor:n}),this._highlightCharRenderer.render(c,{opacity:i.opacity,strokes:i.strokes,strokeColor:a});var u,d,_,p,g,k,v,m=t.userStrokes||{};for(const t in m){var f=m[t];f&&(u=c,v=k=g=p=_=d=void 0,(f={strokeWidth:l,strokeColor:h,...f}).opacity<.05||(({opacity:f,strokeWidth:d,strokeColor:p,points:_}=f),({r:p,g:g,b:k,a:v}=p),u.save(),u.globalAlpha=f,u.lineWidth=d,u.strokeStyle=`rgba(${p},${g},${k},${v})`,u.lineCap="round",u.lineJoin="round",ot(u,_),u.restore()))}}))}},createRenderTarget:ht.init};const ct={charDataLoader:(t,e,r)=>{const i=new XMLHttpRequest;i.overrideMimeType&&i.overrideMimeType("application/json"),i.open("GET",`https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/${t}.json`,!0),i.onerror=t=>{r(i,t)},i.onreadystatechange=()=>{4===i.readyState&&(200===i.status?e(JSON.parse(i.responseText)):0!==i.status&&r&&r(i))},i.send(null)},onLoadCharDataError:null,onLoadCharDataSuccess:null,showOutline:!0,showCharacter:!0,renderer:"svg",width:0,height:0,padding:20,strokeAnimationSpeed:1,strokeFadeDuration:400,strokeHighlightDuration:200,strokeHighlightSpeed:2,delayBetweenStrokes:1e3,delayBetweenLoops:2e3,strokeColor:"#555",radicalColor:null,highlightColor:"#AAF",outlineColor:"#DDD",drawingColor:"#333",leniency:1,showHintAfterMisses:3,highlightOnComplete:!0,highlightCompleteColor:null,markStrokeCorrectAfterMisses:!1,acceptBackwardsStrokes:!1,quizStartStrokeNum:0,averageDistanceThreshold:350,drawingFadeDuration:300,drawingWidth:4,strokeWidth:2,outlineWidth:2,rendererOverride:{}};class ut{constructor(t){this._loadCounter=0,this._isLoading=!1,this.loadingFailed=!1,this._options=t}_debouncedLoad(t,e){var r=t=>{var r;e===this._loadCounter&&null!=(r=this._resolve)&&r.call(this,t)},i=t=>{var r;e===this._loadCounter&&null!=(r=this._reject)&&r.call(this,t)};(t=this._options.charDataLoader(t,r,i))&&("then"in t?t.then(r).catch(i):r(t))}_setupLoadingPromise(){return new Promise(((t,e)=>{this._resolve=t,this._reject=e})).then((t=>{var e,r;return this._isLoading=!1,null!=(e=(r=this._options).onLoadCharDataSuccess)&&e.call(r,t),t})).catch((t=>{if(this._isLoading=!1,this.loadingFailed=!0,!this._options.onLoadCharDataError){if(t instanceof Error)throw t;var e=new Error("Failed to load char data for "+this._loadingChar);throw e.reason=t,e}this._options.onLoadCharDataError(t)}))}loadCharData(t){this._loadingChar=t;var e=this._setupLoadingPromise();return this.loadingFailed=!1,this._isLoading=!0,this._loadCounter++,this._debouncedLoad(t,this._loadCounter),e}}class dt{constructor(t,e={}){var{HanziWriterRenderer:r,createRenderTarget:i}="canvas"===e.renderer?lt:st,s=e.rendererOverride||{};this._renderer={HanziWriterRenderer:s.HanziWriterRenderer||r,createRenderTarget:s.createRenderTarget||i},this.target=this._renderer.createRenderTarget(t,e.width,e.height),this._options=this._assignOptions(e),this._loadingManager=new ut(this._options),this._setupListeners()}static create(t,e,r){return(t=new dt(t,r)).setCharacter(e),t}static loadCharacterData(t,e={}){var r=(()=>{var{_loadingManager:r,_loadingOptions:i}=dt;return(null==r?void 0:r._loadingChar)===t&&i===e?r:new ut({...ct,...e})})();return dt._loadingManager=r,dt._loadingOptions=e,r.loadCharData(t)}static getScalingTransform(t,e,r=0){return{x:(t=new O({width:t,height:e,padding:r})).xOffset,y:t.yOffset,scale:t.scale,transform:`\n        translate(${t.xOffset}, ${t.height-t.yOffset})\n        scale(${t.scale}, ${-1*t.scale})\n      `.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ")}}showCharacter(t={}){return this._options.showCharacter=!0,this._withData((()=>{var e;return null==(e=this._renderState)?void 0:e.run(I("main",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then((e=>{var r;return null!=(r=t.onComplete)&&r.call(t,e),e}))}))}hideCharacter(t={}){return this._options.showCharacter=!1,this._withData((()=>{var e;return null==(e=this._renderState)?void 0:e.run(B("main",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then((e=>{var r;return null!=(r=t.onComplete)&&r.call(t,e),e}))}))}animateCharacter(t={}){return this.cancelQuiz(),this._withData((()=>{var e;return null==(e=this._renderState)?void 0:e.run(V("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes)).then((e=>{var r;return null!=(r=t.onComplete)&&r.call(t,e),e}))}))}animateStroke(t,e={}){return this.cancelQuiz(),this._withData((()=>{var r;return null==(r=this._renderState)?void 0:r.run(((t,e,r,i)=>(r=e.strokes[r],[new $("character."+t,(r=>{var i=r.character[t],s={opacity:1,strokes:{}};for(let t=0;t<e.strokes.length;t++)s.strokes[t]={opacity:i.opacity*i.strokes[t].opacity};return s})),...N(t,r,i)]))("main",this._character,h(t,this._character.strokes.length),this._options.strokeAnimationSpeed)).then((t=>{var r;return null!=(r=e.onComplete)&&r.call(e,t),t}))}))}highlightStroke(t,e={}){return this._withData((()=>{var r,i;if(this._character&&this._renderState)return this._renderState.run(U((r=this._character.strokes,i=t,r[h(i,r.length)]),u(this._options.highlightColor),this._options.strokeHighlightSpeed)).then((t=>{var r;return null!=(r=e.onComplete)&&r.call(e,t),t}))}))}async loopCharacterAnimation(){return this.cancelQuiz(),this._withData((()=>this._renderState.run(((t,e,r,i,s,o)=>((t=V(t,e,r,i,s)).push(new $.Delay(o)),t))("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes,this._options.delayBetweenLoops),{loop:!0})))}pauseAnimation(){return this._withData((()=>{var t;return null==(t=this._renderState)?void 0:t.pauseAll()}))}resumeAnimation(){return this._withData((()=>{var t;return null==(t=this._renderState)?void 0:t.resumeAll()}))}showOutline(t={}){return this._options.showOutline=!0,this._withData((()=>{var e;return null==(e=this._renderState)?void 0:e.run(I("outline",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then((e=>{var r;return null!=(r=t.onComplete)&&r.call(t,e),e}))}))}hideOutline(t={}){return this._options.showOutline=!1,this._withData((()=>{var e;return null==(e=this._renderState)?void 0:e.run(B("outline",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then((e=>{var r;return null!=(r=t.onComplete)&&r.call(t,e),e}))}))}updateDimensions({width:t,height:e,padding:r}){if(void 0!==t&&(this._options.width=t),void 0!==e&&(this._options.height=e),void 0!==r&&(this._options.padding=r),this.target.updateDimensions(this._options.width,this._options.height),this._character&&this._renderState&&this._hanziWriterRenderer&&this._positioner){this._hanziWriterRenderer.destroy();const t=this._initAndMountHanziWriterRenderer(this._character);this._renderState.overwriteOnStateChange((e=>t.render(e))),t.render(this._renderState.state),this._quiz&&this._quiz.setPositioner(this._positioner)}}updateColor(t,e,r={}){let i=[];var s=u("radicalColor"!==t||e?e:this._options.strokeColor),o=(this._options[t]=e,null!=(o=r.duration)?o:this._options.strokeFadeDuration);return i=i.concat(q(t,s,o)),"radicalColor"!==t||e||(i=i.concat(q(t,null,0))),this._withData((()=>{var t;return null==(t=this._renderState)?void 0:t.run(i).then((t=>{var e;return null!=(e=r.onComplete)&&e.call(r,t),t}))}))}quiz(t={}){return this._withData((async()=>{this._character&&this._renderState&&this._positioner&&(this.cancelQuiz(),this._quiz=new Q(this._character,this._renderState,this._positioner),this._options={...this._options,...t},this._quiz.startQuiz(this._options))}))}cancelQuiz(){this._quiz&&(this._quiz.cancel(),this._quiz=void 0)}setCharacter(t){return this.cancelQuiz(),this._char=t,this._hanziWriterRenderer&&this._hanziWriterRenderer.destroy(),this._renderState&&this._renderState.cancelAll(),this._hanziWriterRenderer=null,this._withDataPromise=this._loadingManager.loadCharData(t).then((e=>{if(!e||this._loadingManager.loadingFailed)return;var r;this._character=(r=t,e=function({radStrokes:t,strokes:e,medians:r}){return e.map(((e,i)=>{var s=r[i].map((t=>{var[t,e]=t;return{x:t,y:e}}));return new x(e,s,i,(e=i,0<=(null!=(e=null==t?void 0:t.indexOf(e))?e:-1)))}))}(e),new M(r,e)),this._renderState=new g(this._character,this._options,(t=>i.render(t)));const i=this._initAndMountHanziWriterRenderer(this._character);i.render(this._renderState.state)})),this._withDataPromise}_initAndMountHanziWriterRenderer(t){var e,{width:e,height:r,padding:i}=this._options;return(this._positioner=new O({width:e,height:r,padding:i}),e=new this._renderer.HanziWriterRenderer(t,this._positioner)).mount(this.target),this._hanziWriterRenderer=e}async getCharacterData(){if(this._char)return await this._withData((()=>this._character));throw new Error("setCharacter() must be called before calling getCharacterData()")}_assignOptions(t){var e={...ct,...t};return t.strokeAnimationDuration&&!t.strokeAnimationSpeed&&(e.strokeAnimationSpeed=500/t.strokeAnimationDuration),t.strokeHighlightDuration&&!t.strokeHighlightSpeed&&(e.strokeHighlightSpeed=500/e.strokeHighlightDuration),t.highlightCompleteColor||(e.highlightCompleteColor=e.highlightColor),this._fillWidthAndHeight(e)}_fillWidthAndHeight(t){var e,r;return(t={...t}).width&&!t.height?t.height=t.width:t.height&&!t.width?t.width=t.height:t.width||t.height||(({width:r,height:e}=this.target.getBoundingClientRect()),r=Math.min(r,e),t.width=r,t.height=r),t}_withData(t){if(this._loadingManager.loadingFailed)throw Error("Failed to load character data. Call setCharacter and try again.");return this._withDataPromise?this._withDataPromise.then((()=>{if(!this._loadingManager.loadingFailed)return t()})):Promise.resolve().then(t)}_setupListeners(){this.target.addPointerStartListener((t=>{this._quiz&&(t.preventDefault(),this._quiz.startUserStroke(t.getPoint()))})),this.target.addPointerMoveListener((t=>{this._quiz&&(t.preventDefault(),this._quiz.continueUserStroke(t.getPoint()))})),this.target.addPointerEndListener((()=>{var t;null!=(t=this._quiz)&&t.endUserStroke()}))}}dt._loadingManager=null,dt._loadingOptions=null,e.A=dt},kWh2:function(t,e,r){var i=r("dxB+"),s=r("hgw9"),o=r("wnEH"),n=r("vHVK")("toStringTag"),a=Object,h="Arguments"===o(function(){return arguments}());t.exports=i?o:function(t){var e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=a(t),n))?e:h?o(t):"Object"===(e=o(t))&&s(t.callee)?"Arguments":e}},"5u0C":function(t,e,r){var i=r("lMFB"),s=r("iAz1");t.exports=function(t,e,r){return r.get&&i(r.get,e,{getter:!0}),r.set&&i(r.set,e,{setter:!0}),s.f(t,e,r)}},"dxB+":function(t,e,r){var i={};i[r("vHVK")("toStringTag")]="z",t.exports="[object z]"===String(i)},"/uDU":function(t,e,r){var i=r("kWh2"),s=String;t.exports=function(t){if("Symbol"===i(t))throw new TypeError("Cannot convert a Symbol value to a string");return s(t)}},"0MaD":function(t){var e=TypeError;t.exports=function(t,r){if(t<r)throw new e("Not enough arguments");return t}},kvaN:function(t,e,r){var i=r("P6Ci"),s=r("VWI/"),o=r("/uDU"),n=r("0MaD"),a=(r=URLSearchParams).prototype,h=s(a.append),l=s(a.delete),c=s(a.forEach),u=s([].push);(s=new r("a=1&a=2&b=3")).delete("a",1),s.delete("b",void 0),s+""!="a=2"&&i(a,"delete",(function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return l(this,t);for(var i,s=[],a=(c(this,(function(t,e){u(s,{key:e,value:t})})),n(e,1),o(t)),d=o(r),_=0,p=0,g=!1,k=s.length;_<k;)i=s[_++],g||i.key===a?(g=!0,l(this,i.key)):p++;for(;p<k;)(i=s[p++]).key===a&&i.value===d||h(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},"o5/U":function(t,e,r){var i=r("P6Ci"),s=r("VWI/"),o=r("/uDU"),n=r("0MaD"),a=(r=URLSearchParams).prototype,h=s(a.getAll),l=s(a.has);!(s=new r("a=1")).has("a",2)&&s.has("a",void 0)||i(a,"has",(function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return l(this,t);for(var i=h(this,t),s=(n(e,1),o(r)),a=0;a<i.length;)if(i[a++]===s)return!0;return!1}),{enumerable:!0,unsafe:!0})},pacc:function(t,e,r){var i=r("S4+I"),s=r("VWI/"),o=(r=r("5u0C"),URLSearchParams.prototype),n=s(o.forEach);!i||"size"in o||r(o,"size",{get:function(){var t=0;return n(this,(function(){t++})),t},configurable:!0,enumerable:!0})}}]);