"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[916],{"3ipt":function(e,n,t){t.r(n),t.d(n,{default:function(){return u}});var i=t("XEAi");n=e=>((0,i.dD)("data-v-eaa08018"),e=e(),(0,i.Cn)(),e);const o={class:"relative canvas-wrap"},a=[n((()=>(0,i._)("div",{id:"canvas"},null,-1))),n((()=>(0,i._)("div",{class:"absolute line-height-1 tips"},"模型有49Mb的大小，github加载很慢，能不能加载出来听天由命吧",-1)))];{var r=n=t("Womt");const w={gaze:{},click:{},hover:{}},m=[],h={},f={};Object.keys(w).forEach((function(e,n){h[e]={flag:!1,listener:function(n){f[e](n,l.camera)}}}));var l={};function p(e){const n=[];for(const i in e){var t=e[i].object3d;n.push(t)}return function e(n){let t=[];for(const i in n)"Group"===n[i].type?t=t.concat(e(n[i].children)):t.push(n[i]);return t}(n)}function v(e,n){return function e(n,t){return n[t.id]||e(n,t.parent)}(e,n)}r.onEvent=function(e,n){l.scene=e||{},l.camera=n||{}},r.onEvent.prototype.removeAll=function(){for(const e in w)for(const n in w[e])delete w[e][n]},r.onEvent.prototype.update=function(){for(const e in m)m[e]()},Object.assign(r.Object3D.prototype,{on:function(e,n,t){if(h.hasOwnProperty(e)){w[e][this.id]={object3d:this,callback:Array.from(arguments).slice(1)};const n=h[e];n.flag||(n.flag=!0,n.listener(w[e]))}},off:function(e){if(e)h.hasOwnProperty(e)&&delete w[e][this.id];else for(const e in w)delete w[e][this.id]}}),f.gaze=function(e,n){let t,i,o=!1;const a=new r.Raycaster;m.push((function(){var l;e&&(l=[],a.setFromCamera(new r.Vector2,n),l=p(e),0<(l=a.intersectObjects(l)).length?o||(o=!0,t=l[0].object,(i=v(e,t)).callback[0]&&i.callback[0](t)):(o&&i.callback[1]&&i.callback[1](t),o=!1))}))},f.click=function(e,n){let t,i,o=!1;const a=new r.Raycaster;window.addEventListener("mousedown",(function(l){var c;l.preventDefault(),e&&(a.setFromCamera(new r.Vector2(l.clientX/window.innerWidth*2-1,-l.clientY/window.innerHeight*2+1),n),c=p(e),0<(l=a.intersectObjects(c)).length?o||(o=!0,t=l[0].object,i=v(e,t)):o=!1)}),!1),window.addEventListener("mousemove",(function(e){e.preventDefault(),o=o&&!1}),!1),window.addEventListener("mouseup",(function(e){e.preventDefault(),o&&i.callback[0]&&i.callback[0](t),o=!1}),!1)},f.hover=function(e,n){let t,i,o=!1;const a=new r.Raycaster;window.addEventListener("mousemove",(function(l){var c;l.preventDefault(),e&&(a.setFromCamera(new r.Vector2(l.clientX/window.innerWidth*2-1,-l.clientY/window.innerHeight*2+1),n),c=p(e),0<(l=a.intersectObjects(c)).length?o||(o=!0,t=l[0].object,(i=v(e,t)).callback[0]&&i.callback[0](t)):(o&&i.callback[1]&&i.callback[1](t),o=!1))}),!1)}}var c=n,d=t("Ojbj"),s=t("z6iS"),u=(n={setup(){let e,n,t,o,a,r,l,u,w,m,h,f,p,v,b,g;const y=()=>{if(null!==n&&3<n.children.length){n.children.pop();const i=document.getElementById("canvas");null!==i&&i.removeChild(i.firstChild),window.cancelAnimationFrame(l),window.removeEventListener("resize",E),k(e,n),n=null,t=null,e=null,r=null,o=null,a=null,l=null,w=null,m=null,h=null,f=null,p=null,v=null}},k=(e,n)=>{try{!function n(t){let i=t.children.filter((e=>e));i.forEach((e=>{e.children.length?n(e):"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose(),e.clear&&e.clear())})),t.clear&&t.clear(e),i=null}(n)}catch(n){}try{e.renderLists.dispose(),e.dispose(),e.forceContextLoss(),e.domElement=null,e.content=null,e=null}catch(n){}window.requestAnimationId&&cancelAnimationFrame(window.requestAnimationId),c.Cache.clear()},E=()=>{t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)};(0,i.bv)((()=>{function i(){l=requestAnimationFrame(i),a.rotation.x+=0,a.rotation.y-=.004,o.rotation.x+=0,o.rotation.y-=.004,e.clear(),e.render(n,t)}(function l(){return new Promise((k=>{(e=new c.WebGLRenderer({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio||1),e.setSize(window.innerWidth,window.innerHeight),e.autoClear=!1,e.setClearColor(0,0),document.getElementById("canvas").appendChild(e.domElement),n=new c.Scene,t=new c.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e3),u=new c.onEvent(n,t),h=new c.BoxGeometry(20,24,20),f=new c.MeshBasicMaterial({transparent:!0,opacity:0}),(p=new c.Mesh(h,f)).position.y=77,p.material.opacity=0,t.position.z=400;const j=()=>{alert("点击头部，2000ms后重新加载模型，模拟加载新模型"),p.off("click",j),y(),setTimeout((()=>{l().then((()=>i()))}),2e3)};p.on("click",j),n.add(p),r=new s.z(t,e.domElement),n.add(t),(v=new d.y).load("model/model1.fbx",(function(e){(a=e).scale.set(1,1,1),a.position.x=0,a.position.y=-90,a.position.z=0,a.traverse((function(e){const n=new c.TextureLoader;n.load("model/FBX.fbm/Heart_Bump_B.jpg",(function(n){e.material&&(e.material.map=n),e.material&&(e.material.needsUpdate=!0)}),void 0,(function(e){})),n.load("model/FBX.fbm/Heart_B.jpg",(function(n){e.material&&(e.material.map=n),e.material&&(e.material.needsUpdate=!0)}),void 0,(function(e){}))})),n.add(a),k()}),void 0,(function(e){})),o=new c.Object3D,n.add(o),w=new c.TetrahedronGeometry(2,0),m=new c.MeshPhongMaterial({color:16777215,shading:c.FlatShading});for(let e=0;e<1e3;e++){const e=new c.Mesh(w,m);e.position.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),e.position.multiplyScalar(90+700*Math.random()),e.rotation.set(2*Math.random(),2*Math.random(),2*Math.random()),o.add(e)}b=new c.AmbientLight(10066329),n.add(b),(g=[])[0]=new c.DirectionalLight(16777215,1),g[0].position.set(1,0,0),g[1]=new c.DirectionalLight(1173691,1),g[1].position.set(.75,1,.5),g[2]=new c.DirectionalLight(8519881,1),g[2].position.set(-.75,-1,.5),n.add(g[0]),n.add(g[1]),n.add(g[2]),window.addEventListener("resize",E,!1)}))})().then((()=>i()))})),(0,i.Ah)((()=>{y(),k()}))}},(0,t("uaZu").Z)(n,[["render",function(e,n,t,r,l,c){return(0,i.wg)(),(0,i.iD)("div",o,a)}],["__scopeId","data-v-eaa08018"]]))}}]);