"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[916],{"8X01":function(e,n,t){function i(e){return(0,s.dD)("data-v-59c9617a"),e=e(),(0,s.Cn)(),e}t.r(n),t.d(n,{default:function(){return b}});var a,o,r,c,d,l,s=t("XEAi"),u={class:"relative canvas-wrap"},f=[i((function(){return(0,s._)("div",{id:"canvas"},null,-1)})),i((function(){return(0,s._)("div",{class:"absolute line-height-1 tips"},"模型有49Mb的大小，github加载很慢，能不能加载出来听天由命吧",-1)}))];function m(e){var n,t=[];for(n in e){var i=e[n].object3d;t.push(i)}return function e(n){var t=[];for(var i in n)"Group"===n[i].type?t=t.concat(e(n[i].children)):t.push(n[i]);return t}(t)}function w(e,n){return function e(n,t){return n[t.id]||e(n,t.parent)}(e,n)}t("TeQF"),t("07d7"),t("FZtP"),t("2B1R"),t("tkto"),t("+2oP"),t("pjDv"),t("PKPk"),t("ma9I"),n=t("Womt"),a=n,o={gaze:{},click:{},hover:{}},r=[],c={},d={},Object.keys(o).forEach((function(e,n){c[e]={flag:!1,listener:function(n){d[e](n,l.camera)}}})),l={},a.onEvent=function(e,n){l.scene=e||{},l.camera=n||{}},a.onEvent.prototype.removeAll=function(){for(var e in o)for(var n in o[e])delete o[e][n]},a.onEvent.prototype.update=function(){for(var e in r)r[e]()},Object.assign(a.Object3D.prototype,{on:function(e,n,t){var i;c.hasOwnProperty(e)&&(o[e][this.id]={object3d:this,callback:Array.from(arguments).slice(1)},(i=c[e]).flag||(i.flag=!0,i.listener(o[e])))},off:function(e){if(e)c.hasOwnProperty(e)&&delete o[e][this.id];else for(var n in o)delete o[n][this.id]}}),d.gaze=function(e,n){var t,i,o=!1,c=new a.Raycaster;r.push((function(){var r;e&&(r=[],c.setFromCamera(new a.Vector2,n),r=m(e),0<(r=c.intersectObjects(r)).length?o||(o=!0,t=r[0].object,(i=w(e,t)).callback[0]&&i.callback[0](t)):(o&&i.callback[1]&&i.callback[1](t),o=!1))}))},d.click=function(e,n){var t,i,o=!1,r=new a.Raycaster;window.addEventListener("mousedown",(function(c){var d;c.preventDefault(),e&&(r.setFromCamera(new a.Vector2(c.clientX/window.innerWidth*2-1,-c.clientY/window.innerHeight*2+1),n),d=m(e),0<(c=r.intersectObjects(d)).length?o||(o=!0,t=c[0].object,i=w(e,t)):o=!1)}),!1),window.addEventListener("mousemove",(function(e){e.preventDefault(),o=o&&!1}),!1),window.addEventListener("mouseup",(function(e){e.preventDefault(),o&&i.callback[0]&&i.callback[0](t),o=!1}),!1)},d.hover=function(e,n){var t,i,o=!1,r=new a.Raycaster;window.addEventListener("mousemove",(function(c){var d;c.preventDefault(),e&&(r.setFromCamera(new a.Vector2(c.clientX/window.innerWidth*2-1,-c.clientY/window.innerHeight*2+1),n),d=m(e),0<(c=r.intersectObjects(d)).length?o||(o=!0,t=c[0].object,(i=w(e,t)).callback[0]&&i.callback[0](t)):(o&&i.callback[1]&&i.callback[1](t),o=!1))}),!1)};var h=n,p=t("Ojbj"),v=t("z6iS"),b=(n={setup:function(){function e(){var e;null!==t&&3<t.children.length&&(t.children.pop(),null!==(e=document.getElementById("canvas"))&&e.removeChild(e.firstChild),window.cancelAnimationFrame(r),window.removeEventListener("resize",b),w(n,t),f=u=l=d=c=r=o=a=n=i=t=null)}var n,t,i,a,o,r,c,d,l,u,f,m,w=function(e,n){try{!function n(t){t.children.filter((function(e){return e})).forEach((function(e){e.children.length?n(e):"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose(),e.clear&&e.clear())})),t.clear&&t.clear(e)}(n)}catch(n){}try{e.renderLists.dispose(),e.dispose(),e.forceContextLoss(),e.domElement=null,e.content=null,e=null}catch(n){}window.requestAnimationId&&cancelAnimationFrame(window.requestAnimationId),h.Cache.clear()},b=function(){i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight)};(0,s.bv)((function(){function s(){r=requestAnimationFrame(s),o.rotation.x+=0,o.rotation.y-=.004,a.rotation.x+=0,a.rotation.y-=.004,n.clear(),n.render(t,i)}(function r(){return new Promise((function(w){(n=new h.WebGLRenderer({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio||1),n.setSize(window.innerWidth,window.innerHeight),n.autoClear=!1,n.setClearColor(0,0),document.getElementById("canvas").appendChild(n.domElement),t=new h.Scene,i=new h.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e3),new h.onEvent(t,i),l=new h.BoxGeometry(20,24,20),u=new h.MeshBasicMaterial({transparent:!0,opacity:0}),(f=new h.Mesh(l,u)).position.y=77,f.material.opacity=0,i.position.z=400,f.on("click",(function n(){alert("点击头部，2000ms后重新加载模型，模拟加载新模型"),f.off("click",n),e(),setTimeout((function(){r().then(s)}),2e3)})),t.add(f),new v.z(i,n.domElement),t.add(i),(new p.y).load("demo-static/model/model1.fbx",(function(e){(o=e).scale.set(1,1,1),o.position.x=0,o.position.y=-90,o.position.z=0,o.traverse((function(e){var n=new h.TextureLoader;n.load("demo-static/model/FBX.fbm/Heart_Bump_B.jpg",(function(n){e.material&&(e.material.map=n),e.material&&(e.material.needsUpdate=!0)}),void 0,(function(e){})),n.load("demo-static/model/FBX.fbm/Heart_B.jpg",(function(n){e.material&&(e.material.map=n),e.material&&(e.material.needsUpdate=!0)}),void 0,(function(e){}))})),t.add(o),w()}),void 0,(function(e){})),a=new h.Object3D,t.add(a),c=new h.TetrahedronGeometry(2,0),d=new h.MeshPhongMaterial({color:16777215,shading:h.FlatShading});for(var g=0;g<1e3;g++){var y=new h.Mesh(c,d);y.position.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),y.position.multiplyScalar(90+700*Math.random()),y.rotation.set(2*Math.random(),2*Math.random(),2*Math.random()),a.add(y)}m=new h.AmbientLight(10066329),t.add(m),(m=[])[0]=new h.DirectionalLight(16777215,1),m[0].position.set(1,0,0),m[1]=new h.DirectionalLight(1173691,1),m[1].position.set(.75,1,.5),m[2]=new h.DirectionalLight(8519881,1),m[2].position.set(-.75,-1,.5),t.add(m[0]),t.add(m[1]),t.add(m[2]),window.addEventListener("resize",b,!1)}))})().then(s)})),(0,s.Ah)((function(){e(),w()}))}},(0,t("uaZu").Z)(n,[["render",function(e,n,t,i,a,o){return(0,s.wg)(),(0,s.iD)("div",u,f)}],["__scopeId","data-v-59c9617a"]]))}}]);