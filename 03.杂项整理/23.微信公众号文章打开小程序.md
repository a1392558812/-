## 微信公众号文章打开小程序

### 图文文章打开
> 前置条件： 

> 在微信公众平台中配置小程序：首先，确保你的公众号已经完成了与小程序的关联和绑定。在微信公众平台的小程序管理后台中，选择对应的小程序，并进入「功能设置」页面，配置小程序的跳转规则：在「功能设置」页面中，找到「关联小程序」一栏，点击「设置」按钮。然后，在跳转规则列表中点击「添加规则」。如果在微信公众号文章中打开小程序，用户需要在微信中浏览该公众号文章，并且已关注该公众号。如果读者尚未关注公众号，则需要先关注公众号后才能打开小程序

* 方法一：使用图文链接：

  * 在公众号文章中，可以使用文字链接的方式引导用户打开小程序。你可以在文章中插入小程序的跳转链接或者提供一个文字说明，如「点击这里打开小程序」，对应的文字添加链接到小程序的跳转链接即可。读者在微信中点击链接后，会直接跳转到对应小程序的页面

  * 具体操作
  在公众号管理后台图文素材里新建一个图文信息，然后在该图文信息上方tabs里点击小程序，输入小程序的appid，点击下一步，然后填写下表单，把一下必填的信息（很简单都是一些复制粘贴的东西）。接着选择小程序卡片的展示方式，有多种展示方式，根据自己喜好来选择，这样小程序卡片就会出现在文章中，

* 方法二：使用小程序码：

  * 微信公众平台生成：登录到微信公众平台的小程序管理后台。在左侧菜单中选择「开发」-「开发设置」。在「开发设置」页面中，可以看到「小程序码」一栏，点击「获取小程序码」或「获取小程序二维码」。在弹出的页面中，选择生成小程序码的参数，例如路径、尺寸等，然后点击确认或生成按钮。完成后，会生成一个小程序码图片，你可以直接下载或保存该图片。  
   
  * 小程序管理后台生成：登录到小程序管理后台。在左侧菜单中选择「开发」-「开发设置」。在「开发设置」页面中，找到「显示二维码」一栏。点击「小程序码」或「小程序二维码」的「查看」按钮。弹出的页面中，可以选择小程序码的样式和尺寸等参数，然后点击下载或保存小程序码图片。

  * 动态小程序码生成方式：
  https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/qrcode-link/qr-code/getQRCode.html
  https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/qrcode-link/qr-code/getUnlimitedQRCode.html
  https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/qrcode-link/qr-code/createQRCode.html

  * 接口调用区别：
    * createQRCode：
    生成方式：基于小程序的页面路径生成小程序码。
    使用场景：适用于需要生成与某个具体的页面路径相关的小程序码。
    限制：生成的小程序码仅支持最多 10 万个月活码的规格。

    * getQRCode：
    生成方式：基于小程序的 appID 和页面路径生成小程序码。
    使用场景：适用于生成通用的小程序码。
    限制：生成的小程序码无限制，但不能进行自定义参数设置。

    * getUnlimitedQRCode：
    生成方式：基于小程序的 appID、页面路径和自定义参数生成无限制的小程序码。
    使用场景：适用于生成带有自定义参数的小程序码，可用于识别用户场景或进行业务逻辑。
    限制：生成的小程序码不受数量限制，但有一定的限制条件，例如 customData 参数需要进行加密处理。

* 总结
在发布公众号文章时，建议在适当的位置提供明确的打开小程序的指引，例如在文章开头或结尾提供链接或小程序码。


### 使用开放标签打开

> 微信开放标签使用步骤与微信JS-SDK类似，也需要引入JS文件等步骤。如果是公众号身份的网页，需要绑定安全域名，如果是使用小程序云开发静态网站托管的小程序网页，则不需绑定安全域名即可直接使用（即跳过下面"步骤一：绑定安全域名"）。

1. 绑定域名
登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。

2. 引入JS文件
在需要调用JS接口的页面引入如下JS文件：http://res.wx.qq.com/open/js/jweixin-1.6.0.js （支持https）
如需进一步提升服务稳定性，当上述资源不可访问时，可改访问：http://res2.wx.qq.com/open/js/jweixin-1.6.0.js （支持https）
备注：支持使用 AMD/CMD 标准模块加载方法加载。

3. 通过config接口注入权限验证配置并申请所需开放标签
与使用JS-SDK配置方式相同，所有需要使用开放标签的页面必须先注入配置信息，并通过openTagList字段申请所需要的开放标签，否则将无法使用（同一个url仅需调用一次）。开放标签的申请和JS接口的申请相互独立，因此是可以同时申请的。

    ```js
      wx.config({
        debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印
        appId: '', // 必填，公众号的唯一标识
        timestamp: , // 必填，生成签名的时间戳
        nonceStr: '', // 必填，生成签名的随机串
        signature: '',// 必填，签名
        jsApiList: [], // 必填，需要使用的JS接口列表
        openTagList: [] // 可选，需要使用的开放标签列表，例如['wx-open-launch-app']
      });
    ```

4. 通过ready接口处理成功验证

    ```js
    wx.ready(function () {
      // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中
    });

5. 通过error接口处理失败验证

    ```js
      wx.error(function (res) {
        // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名
      });
    ```

* 使用说明
  1. 所有开放标签都能像普通的HTML标签一样在页面中直接使用，不需要再进行额外的处理。
  如果所使用的标签允许提供插槽，由于插槽中模版的样式是和页面隔离的，因此需要注意在插槽中定义模版的样式。插槽模版及样式均需要通过`<script type="text/wxtag-template"></script>`进行包裹。另外，对于具名插槽还需要通过slot属性声明插槽名称，下文标签插槽中的default插槽为默认插槽，可不声明插槽名称。

  2. 对于标签事件，均可通过event.detail获得详细信息。如果无特殊说明，下文标签事件说明中的返回值均指代event.detail中的内容。

  3. 另外，需要注意以下几点：
  页面中与布局和定位相关的样式，如position: fixed; top -100;等，尽量不要写在插槽模版的节点中，请声明在标签或其父节点上；
  对于有CSP要求的页面，需要添加白名单frame-src https://*.qq.com webcompt:，才能在页面中正常使用开放标签。

* 开放标签
  跳转小程序：wx-open-launch-weapp
  用于页面中提供一个可跳转指定小程序的按钮。使用此标签后，用户需在网页内点击标签按钮方可跳转小程序。H5通过开放标签打开小程序的场景值为1167。

* 开放对象
  已认证的服务号，服务号绑定“JS接口安全域名”下的网页可使用此标签跳转任意合法合规的小程序。
  已认证的非个人主体的小程序，使用小程序云开发的静态网站托管绑定的域名下的网页，可以使用此标签跳转任意合法合规的小程序。

* 错误提示
  若跳转时出现以下页面，表示网页绑定的服务号或小程序无权限，请检查是否符合上述开放对象条件。

* 用例
```html
<wx-open-launch-weapp
  id="launch-btn"
  appid="wx12345678"
  path="pages/home/index?user=123&action=abc">
  <script type="text/wxtag-template">
    <style>.btn { padding: 12px }</style>
    <button class="btn">打开小程序</button>
  </script>
</wx-open-launch-weapp>

<script>
  var btn = document.getElementById('launch-btn');
  btn.addEventListener('launch', function (e) {
    console.log('success');
  });
  btn.addEventListener('error', function (e) {
    console.log('fail', e.detail);
  });
</script>
```